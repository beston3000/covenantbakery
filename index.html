// ENHANCED: Updated renderCart function with item stacking and clear free item display
    function renderCart() {
      console.log('üõí renderCart called with cart:', cart);
      const cartDiv = document.getElementById('cart');
      
      if (cart.length === 0) {
        cartDiv.innerHTML = '<div class="empty-state"><p>Your cart is empty. Add some delicious items!</p></div>';
        document.getElementById('checkout-section').style.display = 'none';
        // Clear cached data when cart is empty
        window.processedCartForCalculations = null;
        updateCartCount();
        return;
      }

      document.getElementById('checkout-section').style.display = 'block';
      resetCheckoutUI();

      // Process buy-X-get-Y deals first
      const processedCart = processBuyGetDeals(cart);
      
      // Store processed cart for calculations
      window.processedCartForCalculations = processedCart;
      
      // Group items for stacking display
      const stackedItems = stackCartItems(processedCart);
      
      let total = 0;
      let cartHTML = '';
      
      stackedItems.forEach((stackedItem) => {
        const { item, quantity, freeQuantity, paidQuantity } = stackedItem;
        const itemPrice = parseFloat(item.price);
        const originalPrice = item.originalPrice ? parseFloat(item.originalPrice) : itemPrice;
        
        // Calculate total for this stack
        const stackTotal = processedCart
          .filter(cartItem => itemsAreIdentical(cartItem, item))
          .reduce((sum, cartItem) => sum + parseFloat(cartItem.price), 0);
        
        total += stackTotal;
        
        // Build quantity display
        let quantityDisplay = '';
        if (quantity > 1) {
          if (freeQuantity > 0 && paidQuantity > 0) {
            quantityDisplay = ` (${paidQuantity} paid + ${freeQuantity} FREE)`;
          } else if (freeQuantity === quantity) {
            quantityDisplay = ` (${quantity} FREE)`;
          } else {
            quantityDisplay = ` (x${quantity})`;
          }
        } else if (item.isFreeItem) {
          quantityDisplay = ` (FREE)`;
        }
        
        // Build price display
        let priceDisplay = '';
        if (freeQuantity === quantity) {
          // All items are free
          priceDisplay = `<span style="color: #28a745; font-weight: bold; font-size: 1.2rem;">FREE!</span>`;
        } else if (freeQuantity > 0) {
          // Mixed paid and free
          const paidTotal = paidQuantity * itemPrice;
          priceDisplay = `${paidTotal.toFixed(2)} <small style="color: #28a745;">(${freeQuantity} free items included!)</small>`;
        } else if (item.originalPrice && item.originalPrice !== item.price) {
          // Discounted items
          if (quantity > 1) {
            priceDisplay = `<span style="text-decoration: line-through; color: #999;">${(originalPrice * quantity).toFixed(2)}</span> ${stackTotal.toFixed(2)}`;
          } else {
            priceDisplay = `<span style="text-decoration: line-through; color: #999;">${originalPrice.toFixed(2)}</span> ${itemPrice.toFixed(2)}`;
          }
        } else {
          // Regular items
          if (quantity > 1) {
            priceDisplay = `${stackTotal.toFixed(2)} <small>(${itemPrice.toFixed(2)} each)</small>`;
          } else {
            priceDisplay = `${itemPrice.toFixed(2)}`;
          }
        }
        
        // Build deal info
        let dealInfo = '';
        if (item.dealInfo) {
          if (item.isFreeItem || freeQuantity > 0) {
            dealInfo = `<small style="color: #28a745; font-weight: bold;">üéâ ${item.dealInfo}</small><br>`;
          } else {
            dealInfo = `<small style="color: #28a745; font-weight: bold;">üè∑Ô∏è ${item.dealInfo}</small><br>`;
          }
        }
        
        cartHTML += `
          <div class="cart-item ${item.dealId ? 'has-deal' : ''}" data-item-key="${getItemKey(item)}">
            <div>
              <span style="font-size: 1.5rem; margin-right: 10px;">${item.emoji}</span>
              <strong>${item.name}${quantityDisplay}</strong> - ${priceDisplay}<br>
              ${dealInfo}
            </div>
            <div class="quantity-controls">
              <button class="btn btn-secondary" onclick="removeOneFromCart('${getItemKey(item)}')" style="padding: 5px 10px; font-size: 0.9rem;">Remove 1</button>
              <button class="btn btn-danger" onclick="removeAllFromCart('${getItemKey(item)}')" style="padding: 5px 10px; font-size: 0.9rem;">Remove All</button>
            </div>
          </div>
        `;
      });
      
      cartHTML += `<div class="cart-total">Cart Items Total: ${total.toFixed(2)}</div>`;
      cartDiv.innerHTML = cartHTML;
      updateCartCount();
      
      // Update checkout totals after rendering
      setTimeout(() => {
        console.log('üîÑ Auto-updating totals from renderCart');
        updateVenmoTotal();
        updateVenmoLink();
      }, 100);
    }
