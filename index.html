<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Covenant Hills Bakery - v2.9</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="script.js" defer></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ° Covenant Hills Bakery</h1>
      <p>Fresh artisan baked goods in Covenant Hills</p>
    </div>

    <div id="location-verification" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
      <div style="background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 500px; margin: 20px;">
        <h2 style="color: #d4691a; margin-bottom: 20px;">ğŸ“ Location Verification Required</h2>
        <p style="margin-bottom: 20px; color: #666; line-height: 1.6;">
          Covenant Hills Bakery serves customers in Covenant Hills and Ladera Ranch, CA only. 
          We need to verify your location to provide our services.
        </p>
        <div id="location-status" style="margin: 20px 0; font-weight: bold;"></div>
        <button id="location-btn" class="btn btn-primary" onclick="requestLocation()" style="margin: 10px;">
          ğŸ“ Share My Location
        </button>
        <p style="margin-top: 20px; font-size: 0.9rem; color: #888;">
          Your location data is only used for verification and is not stored.
        </p>
      </div>
    </div>

    <div id="location-denied" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 10000; display: flex; align-items: center; justify-content: center;">
      <div style="background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 500px; margin: 20px;">
        <h2 style="color: #dc3545; margin-bottom: 20px;">âŒ Service Area Restricted</h2>
        <p style="margin-bottom: 20px; color: #666; line-height: 1.6;">
          Sorry! Covenant Hills Bakery currently only serves customers in:
        </p>
        <ul style="text-align: left; margin: 20px 0; color: #333;">
          <li><strong>Covenant Hills, CA</strong></li>
          <li><strong>Ladera Ranch, CA</strong></li>
        </ul>
        <p style="margin-bottom: 20px; color: #666;">
          We're working on expanding our delivery area. Please check back soon!
        </p>
        <button class="btn btn-secondary" onclick="checkLocationAgain()">
          ğŸ“ Check Location Again
        </button>
      </div>
    </div>

    <div id="status-messages"></div>

    <div id="main-content" style="display: none;">
    <div class="tab-container">
      <div class="tab-navigation">
        <button class="tab-button active" onclick="switchTab('account')" id="account-tab">ğŸ” Account</button>
        <button class="tab-button" onclick="switchTab('menu')" id="menu-tab">ğŸ“¦ Menu</button>
        <button class="tab-button" onclick="switchTab('cart'); console.log('ğŸ›’ Cart tab clicked - will auto-refresh');" id="cart-tab">ğŸ›’ Cart <span id="cart-count">0</span></button>
        <button class="tab-button" onclick="switchTab('orders')" id="orders-tab" style="display: none;">ğŸ“‹ Orders</button>
        <button class="tab-button" onclick="switchTab('admin')" id="admin-tab" style="display: none;">ğŸ‘‘ Admin</button>
        <button class="tab-button" onclick="switchTab('employees')" id="employees-tab" style="display: none;">ğŸ‘¥ Employees</button>
      </div>

      <div class="tab-content">
        <div id="account-panel" class="tab-panel active">
          <div id="signed-out-view">
            <h3 style="color: #d4691a; margin-bottom: 15px;">ğŸ” Account Access</h3>
            
            <div style="margin-bottom: 20px; text-align: center;">
              <button class="btn btn-google" onclick="signInWithGoogle()" style="width: 100%; max-width: 300px;">
                <div class="google-icon">G</div>
                Continue with Google
              </button>
            </div>
            
            <div style="text-align: center; margin: 20px 0; color: #666;">
              <span style="background: white; padding: 0 15px;">or</span>
              <hr style="margin-top: -12px; border: none; border-top: 1px solid #e0e0e0;">
            </div>
            
            <div class="input-group">
              <input id="email" type="email" placeholder="Email Address">
              <input id="password" type="password" placeholder="Password">
            </div>
            <div class="input-group">
              <button class="btn btn-primary" onclick="signUp()">Create Account</button>
              <button class="btn btn-secondary" onclick="signIn()">Sign In</button>
            </div>
          </div>

          <div id="signed-in-view" style="display: none;">
            <div class="user-info">
              <div id="user-avatar" style="width: 60px; height: 60px; border-radius: 50%; margin: 0 auto 15px; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 24px;"></div>
              <h3>ğŸ‘‹ Welcome back!</h3>
              <p id="user-email-display"></p>
              <p id="user-role-display"></p>
              <button class="btn btn-danger" onclick="signOut()" style="margin-top: 15px;">Logout</button>
            </div>
          </div>
        </div>

        <div id="menu-panel" class="tab-panel">
          <h2 style="color: #d4691a; margin-bottom: 20px; text-align: center;">ğŸ“¦ Our Fresh Menu</h2>
          <div id="menu" class="menu-grid">
            <div class="empty-state"><p>Sign in to view our delicious menu items!</p></div>
          </div>
        </div>

        <div id="cart-panel" class="tab-panel">
          <h2 style="color: #d4691a; margin-bottom: 20px; text-align: center;">ğŸ›’ Your Cart</h2>
          <div id="cart">
            <div class="empty-state"><p>Your cart is empty. Add some delicious items!</p></div>
          </div>
          <div id="checkout-section" style="display: none; margin-top: 30px;">
            
            <!-- Delivery Options -->
            <div style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(0, 0, 0, 0.1);">
              <h4 style="color: #d4691a; margin-bottom: 20px; text-align: center;">ğŸ“ Delivery Options</h4>
              
              <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; transition: all 0.3s ease;">
                  <input type="radio" name="delivery-option" value="pickup" checked onchange="updateDeliveryOption(); console.log('ğŸ“ Pickup selected - triggering update');">
                  <span style="font-weight: 600; color: #667eea;">ğŸª Pickup at 7 Moonlight Isle</span>
                </label>
                
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; transition: all 0.3s ease;">
                  <input type="radio" name="delivery-option" value="delivery" onchange="updateDeliveryOption(); console.log('ğŸ“ Delivery selected - triggering update');">
                  <span style="font-weight: 600; color: #667eea;">ğŸšš Delivery (+$1.50)</span>
                </label>
              </div>
              
              <!-- Address Input (hidden by default) -->
              <div id="address-section" style="display: none; background: rgba(248, 249, 250, 0.9); padding: 20px; border-radius: 10px; margin-top: 15px;">
                <h5 style="color: #667eea; margin-bottom: 15px;">ğŸ“ Delivery Address</h5>
                <input id="delivery-address" type="text" placeholder="Enter your full address in Covenant Hills or Ladera Ranch" style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem; margin-bottom: 10px;">
                <input id="delivery-instructions" type="text" placeholder="Delivery instructions (optional)" style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem;">
              </div>
            </div>

            <!-- Payment Instructions -->
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 30px; border-radius: 20px; color: white; text-align: center; margin-bottom: 20px;">
              <h3 style="margin-bottom: 15px; font-family: 'Playfair Display', serif;">ğŸ’³ Payment Instructions</h3>
              <p style="margin-bottom: 20px; opacity: 0.9;">To complete your order, please send payment via Venmo:</p>
              
              <!-- Venmo Payment Button -->
              <a id="venmo-payment-link" href="https://venmo.com/u/YOUR_VENMO_USERNAME" target="_blank" style="display: inline-block; background: #3D95CE; color: white; padding: 15px 30px; border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 1.1rem; margin: 10px; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(61, 149, 206, 0.4);">
                ğŸ“± Pay with Venmo
              </a>
              
              <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px; margin-top: 20px;">
                <p style="margin-bottom: 10px;"><strong>Venmo Username:</strong> @<span id="venmo-username-display">YOUR_VENMO_USERNAME</span></p>
                <p style="margin-bottom: 10px;"><strong>Subtotal:</strong> $<span id="cart-subtotal">0.00</span></p>
                <p style="margin-bottom: 10px;"><strong>Delivery:</strong> <span id="delivery-fee-display">Free Pickup</span></p>
                <p style="margin-bottom: 15px; font-size: 1.2rem;"><strong>Total Amount:</strong> $<span id="venmo-total">0.00</span></p>
                <button onclick="forceUpdateTotals()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; margin: 5px;">ğŸ”„ Update Totals</button>
                <button onclick="forceRefreshCart()" style="background: rgba(102,126,234,0.3); border: 1px solid rgba(102,126,234,0.5); color: white; padding: 8px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; margin: 5px;">ğŸ”„ Refresh Cart</button><br>
                <button onclick="testVenmoPayment()" style="background: rgba(61,149,206,0.3); border: 1px solid rgba(61,149,206,0.5); color: white; padding: 8px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; margin: 5px;">ğŸ§ª Test Venmo</button>
                <button onclick="debugCartCalculations()" style="background: rgba(255,193,7,0.3); border: 1px solid rgba(255,193,7,0.5); color: white; padding: 8px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; margin: 5px;">ğŸ” Debug All</button><br>
                <p style="font-size: 0.9rem; opacity: 0.8;">âš ï¸ Please include your order details in the Venmo note!</p>
              </div>
            </div>
            
            <!-- Order Confirmation -->
            <div style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 15px; text-align: center;">
              <h4 style="color: #d4691a; margin-bottom: 15px;">ğŸ“‹ After Payment</h4>
              <p style="margin-bottom: 20px; color: #666;">Once you've sent the Venmo payment, click below to submit your order:</p>
              <button class="btn btn-success" onclick="submitVenmoOrder()" id="submit-order-btn" style="font-size: 1.2rem; padding: 15px 30px;">âœ… Confirm Order Placed</button>
              <p style="margin-top: 15px; font-size: 0.9rem; color: #888;">We'll confirm receipt of payment and prepare your order!</p>
            </div>
          </div>
        </div>

        <div id="orders-panel" class="tab-panel">
          <h2 style="color: #d4691a; margin-bottom: 20px; text-align: center;">ğŸ“‹ My Orders</h2>
          <div id="orders-list">
            <div class="empty-state"><p>You haven't placed any orders yet.</p></div>
          </div>
        </div>

        <div id="admin-panel" class="tab-panel">
          <h2 style="color: #d4691a; margin-bottom: 20px; text-align: center;">ğŸ‘‘ Admin Dashboard</h2>
          
          <!-- Admin Controls -->
          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;">
            <h3 style="margin-bottom: 20px;">Admin Controls</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
              <button class="btn btn-success" onclick="showAddItemForm()">â• Add New Item</button>
              <button class="btn btn-secondary" onclick="toggleAdminView('menu')">ğŸ“¦ Manage Menu</button>
              <button class="btn btn-secondary" onclick="toggleAdminView('orders')">ğŸ“‹ Manage Orders</button>
              <button class="btn btn-secondary" onclick="toggleAdminView('deals')">ğŸ·ï¸ Manage Deals</button>
            </div>
            
            <!-- Add Item Form -->
            <div id="add-item-form" style="display:none; background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; margin-top: 20px;">
              <h4 style="margin-bottom: 15px;">Add New Bakery Item</h4>
              <input id="item-name" placeholder="Item Name (e.g., Chocolate Croissant)" style="margin-bottom: 10px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <input id="item-description" placeholder="Description" style="margin-bottom: 10px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <input id="item-price" type="number" step="0.01" placeholder="Price (e.g., 4.99)" style="margin-bottom: 10px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <input id="item-stock" type="number" placeholder="Stock Quantity (e.g., 10)" style="margin-bottom: 10px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <input id="item-emoji" placeholder="Emoji (e.g., ğŸ¥)" style="margin-bottom: 15px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <div>
                <button class="btn btn-success" onclick="submitNewItem()">Add Item</button>
                <button class="btn btn-secondary" onclick="hideAddItemForm()">Cancel</button>
              </div>
            </div>
          </div>
          
          <!-- Menu Management Section -->
          <div id="admin-menu-section">
            <h3 style="color: #d4691a; margin-bottom: 15px;">ğŸ“¦ Menu Management</h3>
            <div id="admin-menu-items" class="menu-grid">
              <div class="empty-state"><p>Loading menu items...</p></div>
            </div>
          </div>
          
          <!-- Orders Management Section -->
          <div id="admin-orders-section" style="display: none;">
            <h3 style="color: #d4691a; margin-bottom: 15px;">ğŸ“‹ Order Management</h3>
            <div style="margin-bottom: 20px;">
              <button class="btn btn-secondary" onclick="loadAdminOrders('all')">All Orders</button>
              <button class="btn" onclick="loadAdminOrders('pending-payment')" style="background: #ff9800; color: white;">ğŸ’³ Awaiting Payment</button>
              <button class="btn btn-primary" onclick="loadAdminOrders('pending')">ğŸ“‹ Pending</button>
              <button class="btn btn-success" onclick="loadAdminOrders('completed')">âœ… Completed</button>
              <button class="btn btn-danger" onclick="loadAdminOrders('cancelled')">âŒ Cancelled</button>
            </div>
            <div id="admin-orders-list">
              <div class="empty-state"><p>Loading orders...</p></div>
            </div>
          </div>

          <!-- Deals Management Section -->
          <div id="admin-deals-section" style="display: none;">
            <h3 style="color: #d4691a; margin-bottom: 15px;">ğŸ·ï¸ Deal Management</h3>
            
            <!-- Add Deal Controls -->
            <div style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 15px; margin-bottom: 20px;">
              <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                <button class="btn btn-success" onclick="showAddDealForm()">â• Add New Deal</button>
                <button class="btn btn-secondary" onclick="loadDeals()">ğŸ”„ Refresh Deals</button>
              </div>
              
              <!-- Add Deal Form -->
              <div id="add-deal-form" style="display: none; background: rgba(248, 249, 250, 0.9); padding: 20px; border-radius: 10px; margin-top: 20px;">
                <h4 style="color: #d4691a; margin-bottom: 15px;">Create New Deal</h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Deal Name:</label>
                    <input id="deal-name" placeholder="e.g., Cookie Special" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                  </div>
                  
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Deal Type:</label>
                    <select id="deal-type" onchange="toggleDealFields()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                      <option value="percentage">Percentage Discount</option>
                      <option value="buy-get">Buy X Get Y Free</option>
                      <option value="fixed-discount">Fixed Amount Off</option>
                    </select>
                  </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Select Menu Item:</label>
                  <select id="deal-menu-item" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="">Loading menu items...</option>
                  </select>
                </div>
                
                <!-- Percentage Discount Fields -->
                <div id="percentage-fields" style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Discount Percentage:</label>
                  <input id="deal-percentage" type="number" min="1" max="99" placeholder="e.g., 25" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <!-- Buy X Get Y Fields -->
                <div id="buy-get-fields" style="display: none; margin-bottom: 15px;">
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                      <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Buy Quantity:</label>
                      <input id="deal-buy-quantity" type="number" min="1" placeholder="e.g., 2" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Get Free:</label>
                      <input id="deal-free-quantity" type="number" min="1" placeholder="e.g., 1" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                  </div>
                </div>
                
                <!-- Fixed Discount Fields -->
                <div id="fixed-discount-fields" style="display: none; margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Discount Amount ($):</label>
                  <input id="deal-fixed-amount" type="number" step="0.01" min="0.01" placeholder="e.g., 2.50" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">Deal Description (optional):</label>
                  <input id="deal-description" placeholder="e.g., Limited time offer!" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div>
                  <button class="btn btn-success" onclick="submitNewDeal()">ğŸ’¾ Create Deal</button>
                  <button class="btn btn-secondary" onclick="hideAddDealForm()">âŒ Cancel</button>
                </div>
              </div>
            </div>
            
            <!-- Active Deals List -->
            <div id="deals-list">
              <div class="empty-state"><p>Loading deals...</p></div>
            </div>
          </div>
        </div>

        <div id="employees-panel" class="tab-panel">
          <h2 style="color: #d4691a; margin-bottom: 20px; text-align: center;">ğŸ‘¥ Employee Management</h2>
          
          <!-- Employee Controls -->
          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;">
            <h3 style="margin-bottom: 20px;">Employee Controls</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
              <button class="btn btn-success" onclick="showAddEmployeeForm()">â• Add New Employee</button>
              <button class="btn btn-secondary" onclick="loadEmployees()">ğŸ”„ Refresh List</button>
            </div>
            
            <!-- Add Employee Form -->
            <div id="add-employee-form" style="display:none; background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; margin-top: 20px;">
              <h4 style="margin-bottom: 15px;">Add New Employee</h4>
              <input id="employee-name" placeholder="Employee Name (e.g., John Smith)" style="margin-bottom: 10px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <input id="employee-role" placeholder="Role (e.g., Baker, Cashier, Manager)" style="margin-bottom: 10px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <input id="employee-email" type="email" placeholder="Email (optional)" style="margin-bottom: 10px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <input id="employee-phone" placeholder="Phone (optional)" style="margin-bottom: 10px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <input id="employee-hourly-rate" type="number" step="0.01" placeholder="Hourly Rate (optional)" style="margin-bottom: 15px; background: rgba(255, 255, 255, 0.9); color: #333; width: 100%;">
              <div>
                <button class="btn btn-success" onclick="submitNewEmployee()">Add Employee</button>
                <button class="btn btn-secondary" onclick="hideAddEmployeeForm()">Cancel</button>
              </div>
            </div>
          </div>
          
          <!-- Employee List -->
          <div id="employees-section">
            <h3 style="color: #d4691a; margin-bottom: 15px;">ğŸ‘¥ Current Employees</h3>
            <div id="employees-list" class="menu-grid">
              <div class="empty-state"><p>Loading employees...</p></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>
</body>
</html>
